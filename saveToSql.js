const fs = require("fs")
const discord = require("discord.js");
var client = new discord.Client({ws:{intents:discord.Intents.ALL}});

// let content = JSON.parse(fs.readFileSync(process.argv[2], "utf-8"))
let content = JSON.parse('[{"id":"305096392911749121","s":69580,"as":209173},{"id":"289494666418847744","s":60023,"as":167831},{"id":"248903394243117056","s":47350,"as":205050},{"id":"231852423344422912","s":35670,"as":72427},{"id":"262598052248944640","s":29445,"as":94407},{"id":"345295975109361664","s":27837,"as":61962},{"id":"546697116148432917","s":27716,"as":28968},{"id":"395370353460772865","s":24756,"as":88409},{"id":"339186886801096734","s":23947,"as":42818},{"id":"334043179986714634","s":22887,"as":127465},{"id":"348595724407144458","s":21477,"as":119366},{"id":"268492669892820992","s":12208,"as":107445},{"id":"538409009900683264","s":6357,"as":8066},{"id":"280769421604290560","s":5323,"as":35937},{"id":"364051166666948609","s":2897,"as":2897},{"id":"340481631607586819","s":2200,"as":3992},{"id":"410131730217828352","s":1241,"as":1291},{"id":"289435656608940033","s":1000,"as":1000},{"id":"818949803437457469","s":709,"as":709},{"id":"332561091106177027","s":640,"as":640},{"id":"336865368456953858","s":636,"as":636},{"id":"210515187508314123","s":622,"as":1211},{"id":"276419462696009729","s":579,"as":917},{"id":"255438512860430361","s":335,"as":335},{"id":"179668942342717440","s":299,"as":3470},{"id":"344544314740834305","s":291,"as":1101},{"id":"434715404284461056","s":209,"as":209},{"id":"305039963056242688","s":145,"as":388},{"id":"526756333257621514","s":123,"as":123},{"id":"317784775266140171","s":106,"as":663},{"id":"303792538467434496","s":95,"as":2055},{"id":"442025803816108057","s":86,"as":86},{"id":"272073645524779012","s":65,"as":11699},{"id":"206845274075693057","s":56,"as":774},{"id":"214090081638547456","s":56,"as":7106},{"id":"350382966888988672","s":51,"as":51},{"id":"248486229996339202","s":11,"as":11},{"id":"692895433390948362","s":1,"as":1},{"id":"250697385515286528","s":1,"as":4},{"id":"332608678027067393","s":1,"as":1590},{"id":"656782648001167370","s":1,"as":1},{"id":"167761414788743168","s":0,"as":80},{"id":"260802687354929162","s":0,"as":345},{"id":"598858223415590932","s":0,"as":76},{"id":"289451000337530882","s":0,"as":111361},{"id":"317624265627402240","s":0,"as":72788},{"id":"231493051141455872","s":0,"as":43211},{"id":"270179925103869963","s":0,"as":36423},{"id":"500345535878660097","s":0,"as":31027},{"id":"325549713644453888","s":0,"as":4937},{"id":"314465817859457024","s":0,"as":3773},{"id":"197350667147411456","s":0,"as":1015},{"id":"239816598800695296","s":0,"as":980},{"id":"224477709625982977","s":0,"as":595},{"id":"277084864346587136","s":0,"as":553},{"id":"433332008261910548","s":0,"as":436},{"id":"432249168229171201","s":0,"as":183},{"id":"688840232103313451","s":0,"as":166},{"id":"260391573076836382","s":0,"as":155},{"id":"329052015940599818","s":0,"as":139},{"id":"251398533352128513","s":0,"as":59},{"id":"259349335727144960","s":0,"as":38},{"id":"443122381922369546","s":0,"as":27},{"id":"376459233824210964","s":0,"as":1},{"id":"201453053088497664","s":0,"as":1}]')
let Sql = require("./bot/sqlconnector")
async function f(){
    let members = client.guilds.cache.get("532956456492728320").members.cache
    let sql = await new Sql("helibot")
    let scores = await sql.query("select * from Points")
    content.forEach(e=>{
        let username
        try{username = members.get(e.id).user.username}
        catch{console.log(e.id);return}
        // if(!scores.map(e=>e.User).includes(e.id)){
            sql.query(`INSERT INTO Points (User, Name, Points, AncienScore) VALUES (${e.id}, "${username}", ${e.s}, ${e.as-e.s});`)
        // }
    })  
}
client.on("ready", ()=>{
    f()
    // console.log(content.length)
})
client.login(require("./token").discord)